<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Stock Analyst Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons Fix: Use unpkg UMD build for better compatibility -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0; /* Slate 200 */
        }
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .highlight-panel {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.95));
            border: 1px solid rgba(251, 191, 36, 0.3);
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.1);
        }
        .sector-header {
            background: linear-gradient(90deg, rgba(30, 41, 59, 0.9) 0%, rgba(30, 41, 59, 0) 100%);
            border-left: 4px solid #fbbf24;
        }
        .gold-gradient-text {
            background: linear-gradient(135deg, #fbbf24, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; 
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            border-color: rgba(251, 191, 36, 0.3);
        }
        .tag {
            font-size: 0.7rem;
            padding: 0.1rem 0.4rem;
            border-radius: 0.2rem;
            background: rgba(255,255,255,0.1);
            color: #94a3b8;
        }
        .per-tag {
            font-size: 0.7rem;
            padding: 0.1rem 0.4rem;
            border-radius: 0.2rem;
            background: rgba(16, 185, 129, 0.1);
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.3);
            font-weight: bold;
        }
        .sentiment-bar-bg {
            background-color: rgba(255, 255, 255, 0.1);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
        }
        .sentiment-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #d97706, #fbbf24);
            border-radius: 3px;
            transition: width 1s ease-out;
        }
        .timeline-item {
            position: relative;
            padding-left: 1rem;
            border-left: 2px solid #334155;
            margin-bottom: 0.75rem;
        }
        .timeline-item:last-child {
            margin-bottom: 0;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -5px;
            top: 6px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #fbbf24;
        }
        .source-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(51, 65, 85, 0.5);
            border: 1px solid rgba(251, 191, 36, 0.2);
            border-radius: 9999px;
            font-size: 0.85rem;
            color: #e2e8f0;
            transition: all 0.3s;
        }
        .source-badge:hover {
            background: rgba(51, 65, 85, 0.8);
            border-color: rgba(251, 191, 36, 0.5);
            transform: translateY(-1px);
        }
        /* Expert Specific Colors */
        .expert-stock-artisan { color: #fbbf24; } /* Amber-400 */
        .expert-park-doohwan { color: #22d3ee; } /* Cyan-400 */
        .expert-default { color: #94a3b8; } /* Slate-400 */
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <!-- Header -->
    <header class="max-w-7xl mx-auto mb-6 flex flex-col md:flex-row justify-between items-center gap-6">
        <div>
            <h1 class="text-4xl font-bold tracking-tight mb-2">
                <span class="gold-gradient-text">Pro Stock</span> Insight
            </h1>
            <p class="text-slate-400 text-sm">전문가 분석 아카이브 & 섹터별 포트폴리오</p>
        </div>
        <div class="flex gap-4">
            <div class="glass-panel px-6 py-4 rounded-xl text-center min-w-[140px]">
                <p class="text-xs text-slate-400 uppercase tracking-wider mb-1">총 분석 종목</p>
                <p class="text-3xl font-bold text-white" id="total-count">0</p>
            </div>
            <div class="glass-panel px-6 py-4 rounded-xl text-center min-w-[140px]">
                <p class="text-xs text-slate-400 uppercase tracking-wider mb-1">최근 업데이트</p>
                <p class="text-sm font-medium text-amber-400 mt-2" id="last-update">-</p>
            </div>
        </div>
    </header>

    <!-- Source Summary Section -->
    <div class="max-w-7xl mx-auto mb-8">
        <h3 class="text-sm text-slate-500 mb-3 flex items-center gap-2">
            <i data-lucide="history" class="w-4 h-4"></i> 최근 반영된 분석 리포트 소스
        </h3>
        <div id="source-summary-container" class="flex flex-wrap gap-3">
            <!-- Badges will be injected here -->
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto">
        
        <!-- Top 5 Sentiment Picks -->
        <section id="top-picks-section" class="mb-12">
            <div class="flex items-center gap-2 mb-4">
                <i data-lucide="crown" class="w-5 h-5 text-amber-400"></i>
                <h2 class="text-xl font-bold text-white">종합 긍정 지수 TOP 5</h2>
            </div>
            <div id="top-picks-container" class="grid grid-cols-1 md:grid-cols-5 gap-4">
                <!-- Top 5 cards injected here -->
            </div>
        </section>

        <!-- Controls / Filter -->
        <div class="flex justify-between items-end mb-6 text-sm text-slate-500 border-b border-slate-800 pb-2">
            <h2 class="text-lg font-semibold text-slate-300">섹터별 상세 분석</h2>
            <span class="flex items-center gap-2 text-xs">
                <i data-lucide="database" class="w-3 h-3"></i> 데이터 자동 동기화 중
            </span>
        </div>

        <div id="sectorContainer" class="space-y-12">
            <!-- Sectors will be injected here -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden flex-col items-center justify-center py-20 text-slate-500">
            <i data-lucide="inbox" class="w-16 h-16 mb-4 opacity-50"></i>
            <p class="text-lg">등록된 분석 데이터가 없습니다.</p>
        </div>
    </main>

    <footer class="max-w-7xl mx-auto mt-12 py-6 border-t border-slate-800 text-center text-slate-500 text-xs">
        <p>&copy; 2026 Pro Stock Insight. All rights reserved.</p>
    </footer>

    <script>
        // Init function to safely call Lucide
        function initIcons() {
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            } else {
                console.warn('Lucide icons library not loaded yet.');
            }
        }

        // State Management
        let recommendations = [];
        const STORAGE_KEY = 'stock_pro_data_v9'; // Version bumped

        // Initial Data 
        // Note: Added PER mentions in rationale for demonstration
        const initialData = [
            // 반도체 / IT
            {
                id: 301,
                sector: '반도체 / IT',
                date: '2026-02-07',
                expert: '주식장인',
                stockName: 'ISC',
                code: '095340',
                price: '-',
                targetPrice: '신고가 갱신',
                sentiment: 95,
                rationale: '시장이 공포를 느낄 때 오히려 신고가를 갱신하며 올라가는 강한 종목. 반도체 소부장 내 대장주 흐름 지속. PER 15배 수준으로 재평가 기대.'
            },
            {
                id: 302,
                sector: '반도체 / IT',
                date: '2026-02-07',
                expert: '주식장인',
                stockName: 'HPSP',
                code: '403870',
                price: '-',
                targetPrice: '-',
                sentiment: 88,
                rationale: '애프터마켓 상승 마감. 흔들리는 시장에서도 견조한 흐름을 유지하는 소부장 핵심 종목. 고압수소 어닐링 독점 기술 부각.'
            },
            {
                id: 303,
                sector: '반도체 / IT',
                date: '2026-02-07',
                expert: '주식장인',
                stockName: '리노공업',
                code: '058470',
                price: '-',
                targetPrice: '-',
                sentiment: 85,
                rationale: '반도체 지수 반등과 함께 플러스 마감. AI 및 비메모리 테스트 수요 증가 수혜 유효. 역사적 저점 P/E 18배 근접.'
            },
            // 제약 / 바이오
            {
                id: 304,
                sector: '제약 / 바이오',
                date: '2026-02-07',
                expert: '주식장인',
                stockName: '셀트리온',
                code: '068270',
                price: '-',
                targetPrice: '-',
                sentiment: 92,
                rationale: '실적 성장과 이익 구조(마진율) 개선이 뚜렷하여 외국인이 매수 중. 불안한 장세에서 믿고 갈 수 있는 실적주.'
            },
            {
                id: 305,
                sector: '제약 / 바이오',
                date: '2026-02-07',
                expert: '주식장인',
                stockName: '한미약품',
                code: '128940',
                price: '-',
                targetPrice: '-',
                sentiment: 90,
                rationale: '외국인 및 기관 수급 유입. 실적 전망이 좋고 이익 케파가 지속적으로 늘어나는 우량주.'
            },
            {
                id: 306,
                sector: '제약 / 바이오',
                date: '2026-02-07',
                expert: '주식장인',
                stockName: '에스티팜',
                code: '237690',
                price: '-',
                targetPrice: '-',
                sentiment: 88,
                rationale: '기관/외국인이 선호하는 실적 성장주. RNA 치료제 원료 시장 확대 수혜.'
            },
             {
                id: 307,
                sector: '제약 / 바이오',
                date: '2026-02-07',
                expert: '주식장인',
                stockName: '엘앤씨바이오',
                code: '290650',
                price: '-',
                targetPrice: '-',
                sentiment: 87,
                rationale: '실적이 뒷받침되는 바이오 기업. 최근 조정은 매수 기회로 판단.'
            },
            // 화장품 / 소비재
            {
                id: 308,
                sector: '화장품 / 소비재',
                date: '2026-02-07',
                expert: '주식장인',
                stockName: '에이피알',
                code: '278470',
                price: '-',
                targetPrice: '-',
                sentiment: 85,
                rationale: '2월 조정장에서도 플러스 마감하며 견조한 흐름. 글로벌 홈 뷰티 디바이스 시장 성장 수혜. PER 12배 저평가 매력.'
            },
            {
                id: 309,
                sector: '화장품 / 소비재',
                date: '2026-02-07',
                expert: '주식장인',
                stockName: '한국콜마',
                code: '161890',
                price: '-',
                targetPrice: '-',
                sentiment: 84,
                rationale: '화장품 섹터 긍정적 시각 유지. 수출 실적 호조에 따른 실적 개선 기대.'
            },
            // 건설 / 인프라 / 기계
            {
                id: 310,
                sector: '건설 / 인프라 / 기계',
                date: '2026-02-07',
                expert: '주식장인',
                stockName: '진성티이씨',
                code: '036890',
                price: '-',
                targetPrice: '-',
                sentiment: 88,
                rationale: '미국 캐터필러 신고가 갱신 수혜주. 우크라 재건 및 트럼프 인프라 정책 모멘텀. 최근 조정은 매수 찬스.'
            },
            {
                id: 203,
                sector: '건설 / 인프라 / 기계',
                date: '2026-02-06',
                expert: '박두환',
                stockName: 'DL이앤씨',
                code: '375500',
                price: '-',
                targetPrice: '-',
                sentiment: 85,
                rationale: '철저한 원가 관리로 영업이익 급증. 높은 재무 건전성 및 하이엔드 브랜드 경쟁력. PBR 0.3배 수준.'
            },
            // 에너지 / 원전
            {
                id: 201,
                sector: '에너지 / 원전',
                date: '2026-02-06',
                expert: '박두환',
                stockName: '두산에너빌리티',
                code: '034020',
                price: '-',
                targetPrice: '-',
                sentiment: 88,
                rationale: '대미 투자 압박 해소 카드로 원전 부상. SMR 수주 파이프라인 가시화.'
            },
            {
                id: 202,
                sector: '에너지 / 원전',
                date: '2026-02-06',
                expert: '박두환',
                stockName: '한국전력',
                code: '015760',
                price: '-',
                targetPrice: '-',
                sentiment: 80,
                rationale: '직류(DC) 기반 전력 기술 등 신기술로 전력망 디지털 전환 주도.'
            },
            // 에너지 / 화학 (태양광)
             {
                id: 206,
                sector: '에너지 / 화학 (태양광)',
                date: '2026-02-06',
                expert: '박두환',
                stockName: '한화솔루션',
                code: '009830',
                price: '-',
                targetPrice: '-',
                sentiment: 86,
                rationale: '신한은행 협력으로 3억 달러 자금 확보, 북미 태양광 밸류체인 구축 가속화.'
            },
            {
                id: 101,
                sector: '에너지 / 화학 (태양광)',
                date: '2026-02-08',
                expert: '박두환',
                stockName: '한화솔루션',
                code: '009830',
                price: '-',
                targetPrice: '관심',
                sentiment: 88,
                rationale: '페로브스카이트 탠덤 셀 분야 상용화 준비가 가장 현실적인 기업.'
            },
            {
                id: 102,
                sector: '에너지 / 화학 (태양광)',
                date: '2026-02-08',
                expert: '박두환',
                stockName: 'OCI홀딩스',
                code: '010060',
                price: '-',
                targetPrice: '관심',
                sentiment: 85,
                rationale: '탠덤 태양전지 핵심 소재 폴리실리콘 공급. 안정적인 공급망 역할. PER 3배 수준의 저평가 매력.'
            },
            {
                id: 103,
                sector: '에너지 / 화학 (태양광)',
                date: '2026-02-08',
                expert: '박두환',
                stockName: 'OCI',
                code: '456040',
                price: '-',
                targetPrice: '관심',
                sentiment: 84,
                rationale: '페로브스카이트 보호 소재 및 공정 기술 보유.'
            },
            // 로봇 / 방산
             {
                id: 204,
                sector: '로봇 / 방산',
                date: '2026-02-06',
                expert: '박두환',
                stockName: 'LG전자',
                code: '066570',
                price: '-',
                targetPrice: '-',
                sentiment: 86,
                rationale: '자회사 베어로보틱스와 협력해 상업용 로봇 솔루션 성과 가시화.'
            },
            {
                id: 205,
                sector: '로봇 / 방산',
                date: '2026-02-06',
                expert: '박두환',
                stockName: '대한항공',
                code: '003490',
                price: '-',
                targetPrice: '-',
                sentiment: 87,
                rationale: '항공우주사업본부 흑자 전환 및 무인기 개발 등 방산 포트폴리오 강화.'
            },
             {
                id: 1,
                sector: '반도체 / IT',
                date: '2026-02-08',
                expert: '주식장인',
                stockName: 'LG이노텍',
                code: '011070',
                price: '-',
                targetPrice: '상향 조정',
                sentiment: 92,
                rationale: '아이폰17 판매 호조 및 고환율 수혜 기대. 패키지 기판 수요 증가. PER 8배 수준 도달.'
            },
             {
                id: 2,
                sector: '반도체 / IT',
                date: '2026-02-08',
                expert: '주식장인',
                stockName: '삼성전자',
                code: '005930',
                price: '-',
                targetPrice: '-',
                sentiment: 85,
                rationale: 'SK하이닉스 대비 주가 상승폭이 낮아 가격 매력 부각.'
            },
            {
                id: 5,
                sector: '제약 / 바이오',
                date: '2026-02-08',
                expert: '주식장인',
                stockName: '리가켐바이오',
                code: '141080',
                price: '-',
                targetPrice: '신고가',
                sentiment: 95,
                rationale: '오리온 인수 후 풍부한 자금력을 바탕으로 성장 가속화. ADC 플랫폼 고성장.'
            },
        ];

        // Load Data on Startup
        window.addEventListener('DOMContentLoaded', () => {
            initIcons();

            // Check if we have stored data in the new version
            const storedData = localStorage.getItem(STORAGE_KEY);
            
            if (storedData) {
                recommendations = JSON.parse(storedData);
            } else {
                recommendations = initialData;
                saveToStorage();
            }
            
            renderUpdateSummary();
            const processedData = processStocks(recommendations);
            renderTopPicks(processedData);
            renderSectors(processedData);
            updateStats();
        });

        // Helper: Process Data (Merge Duplicates & Calculate Avg Sentiment)
        function processStocks(rawList) {
            const stockMap = {};

            rawList.forEach(item => {
                const key = item.code || item.stockName;
                if (!stockMap[key]) {
                    stockMap[key] = {
                        code: item.code,
                        stockName: item.stockName,
                        sector: item.sector,
                        targetPrice: item.targetPrice,
                        price: item.price,
                        entries: []
                    };
                }

                // Add entry
                // Extract PER if present
                const perMatch = item.rationale.match(/(?:PER|P\/E)\s*(\d+(\.\d+)?)/i);
                const perValue = perMatch ? perMatch[1] : null;

                stockMap[key].entries.push({
                    ...item,
                    per: perValue
                });

                // Keep latest Target Price & Price
                const currentMainDate = new Date(stockMap[key].date || 0);
                const newEntryDate = new Date(item.date);
                if (newEntryDate >= currentMainDate) {
                    stockMap[key].targetPrice = item.targetPrice;
                    stockMap[key].price = item.price;
                    stockMap[key].date = item.date; // Latest date
                }
            });

            // Flatten to array and calculate stats
            return Object.values(stockMap).map(stock => {
                const totalSentiment = stock.entries.reduce((sum, e) => sum + e.sentiment, 0);
                const avgSentiment = Math.round(totalSentiment / stock.entries.length);
                
                // Collect PERs if multiple
                const perSet = new Set();
                stock.entries.forEach(e => { if(e.per) perSet.add(e.per); });
                const displayPer = perSet.size > 0 ? Array.from(perSet).join(', ') : null;

                return {
                    ...stock,
                    avgSentiment: avgSentiment,
                    displayPer: displayPer,
                    entryCount: stock.entries.length
                };
            });
        }

        // Helper: Get Expert Color Class
        function getExpertColor(expertName) {
            if (expertName.includes('주식장인')) return 'expert-stock-artisan';
            if (expertName.includes('박두환')) return 'expert-park-doohwan';
            return 'expert-default';
        }

        // Render Top 5 Picks
        function renderTopPicks(processedStocks) {
            const container = document.getElementById('top-picks-container');
            
            // Sort by Avg Sentiment Descending
            const sorted = [...processedStocks].sort((a, b) => b.avgSentiment - a.avgSentiment);
            const top5 = sorted.slice(0, 5);

            container.innerHTML = top5.map((stock, index) => `
                <div class="highlight-panel rounded-lg p-4 card-hover flex flex-col justify-between h-full">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs font-bold text-amber-500">TOP ${index + 1}</span>
                        ${stock.displayPer ? `<span class="per-tag">PER ${stock.displayPer}배</span>` : ''}
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-white leading-tight mb-1">${stock.stockName}</h3>
                        <div class="flex items-center gap-1 text-xs text-slate-400">
                             <span class="bg-slate-800 px-1 rounded">${stock.code}</span>
                             <span>${stock.sector.split('/')[0]}</span>
                        </div>
                    </div>
                    <div class="mt-3">
                        <div class="flex justify-between text-xs mb-1">
                            <span class="text-slate-400">긍정 지수</span>
                            <span class="text-amber-400 font-bold">${stock.avgSentiment}</span>
                        </div>
                        <div class="sentiment-bar-bg">
                            <div class="sentiment-bar-fill" style="width: ${stock.avgSentiment}%"></div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderUpdateSummary() {
            const container = document.getElementById('source-summary-container');
            const sources = new Set();
            const sourceObjects = [];

            recommendations.forEach(item => {
                const key = `${item.date}|${item.expert}`;
                if (!sources.has(key)) {
                    sources.add(key);
                    sourceObjects.push({
                        date: item.date,
                        expert: item.expert
                    });
                }
            });

            sourceObjects.sort((a, b) => new Date(b.date) - new Date(a.date));

            container.innerHTML = sourceObjects.map(src => {
                const colorClass = getExpertColor(src.expert);
                return `
                <div class="source-badge">
                    <i data-lucide="calendar-check" class="w-3 h-3 ${colorClass}"></i>
                    <span class="font-bold ${colorClass}">${src.expert}</span>
                    <span class="text-slate-400 border-l border-slate-600 pl-2 ml-1 text-xs">${src.date}</span>
                </div>
            `}).join('');
            
            initIcons();
        }

        // Render Sectors
        function renderSectors(processedStocks) {
            const container = document.getElementById('sectorContainer');
            const emptyState = document.getElementById('emptyState');
            
            container.innerHTML = '';

            if (processedStocks.length === 0) {
                emptyState.classList.remove('hidden');
                emptyState.classList.add('flex');
                return;
            } else {
                emptyState.classList.add('hidden');
                emptyState.classList.remove('flex');
            }

            // Group processed stocks by sector
            const sectors = {};
            processedStocks.forEach(stock => {
                if (!sectors[stock.sector]) sectors[stock.sector] = [];
                sectors[stock.sector].push(stock);
            });

            Object.keys(sectors).forEach(sectorName => {
                const sectorSection = document.createElement('div');
                sectorSection.className = 'mb-10 animate-fade-in';
                
                // Header
                const headerHtml = `
                    <div class="flex items-center gap-3 mb-6 sector-header pl-4 py-2 rounded-r-lg">
                        <h2 class="text-2xl font-bold text-white tracking-tight">${sectorName}</h2>
                        <span class="text-xs text-slate-400 bg-slate-800 px-2 py-1 rounded-full border border-slate-700">
                            ${sectors[sectorName].length} 종목
                        </span>
                    </div>
                `;
                
                // Grid
                const gridHtml = document.createElement('div');
                gridHtml.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6';

                sectors[sectorName].forEach(stock => {
                    // Sort entries desc date
                    stock.entries.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    const isMulti = stock.entryCount > 1;
                    const colSpanClass = isMulti ? 'md:col-span-2' : '';
                    const bgClass = isMulti ? 'bg-slate-800/80 border-amber-500/50' : 'glass-panel';

                    const card = document.createElement('div');
                    card.className = `${bgClass} rounded-xl p-6 transition duration-300 card-hover flex flex-col h-full border border-slate-700/50 ${colSpanClass}`;
                    
                    // PER Tag Logic
                    const perTagHtml = stock.displayPer ? `<span class="per-tag ml-2">PER ${stock.displayPer}배</span>` : '';

                    // History Content
                    let contentHtml = '';
                    if (isMulti) {
                        contentHtml = `<div class="space-y-4 max-h-80 overflow-y-auto pr-2 custom-scrollbar">`;
                        stock.entries.forEach(entry => {
                            const expertColorClass = getExpertColor(entry.expert);
                            contentHtml += `
                                <div class="timeline-item">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-xs font-bold ${expertColorClass}">${entry.expert} <span class="text-slate-500 font-normal">(${entry.date})</span></span>
                                        <span class="text-xs text-amber-500/80">지수: ${entry.sentiment}</span>
                                    </div>
                                    <p class="text-slate-300 text-sm leading-relaxed">${entry.rationale}</p>
                                </div>
                            `;
                        });
                        contentHtml += `</div>`;
                    } else {
                        const entry = stock.entries[0];
                        const expertColorClass = getExpertColor(entry.expert);
                        contentHtml = `
                            <div class="bg-slate-900/50 rounded-lg p-3 border border-slate-800 h-full">
                                <p class="text-slate-300 text-sm leading-relaxed whitespace-pre-wrap">${entry.rationale} <span class="text-xs font-bold ${expertColorClass} whitespace-nowrap">(${entry.date} ${entry.expert})</span></p>
                            </div>
                        `;
                    }

                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="tag border border-slate-600">${stock.code || 'CODE'}</span>
                                    ${isMulti ? '<span class="tag bg-amber-500/20 text-amber-400 border-amber-500/30">누적 추천 ' + stock.entryCount + '회</span>' : '<span class="text-xs text-slate-400">Target</span>'}
                                </div>
                                <div class="flex items-center">
                                    <h3 class="text-xl font-bold text-white tracking-tight leading-snug">${stock.stockName}</h3>
                                    ${perTagHtml}
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="text-lg font-bold text-amber-400">${stock.targetPrice || '-'}</span>
                            </div>
                        </div>

                        <!-- Sentiment Bar -->
                        <div class="mb-4">
                            <div class="flex justify-between text-xs mb-1">
                                <span class="text-slate-400">종합 긍정 지수</span>
                                <span class="text-amber-500 font-bold">${stock.avgSentiment} / 100</span>
                            </div>
                            <div class="sentiment-bar-bg">
                                <div class="sentiment-bar-fill" style="width: ${stock.avgSentiment}%"></div>
                            </div>
                        </div>
                        
                        <div class="flex-grow">
                            ${contentHtml}
                        </div>

                        ${stock.price && stock.price !== '-' ? `
                        <div class="mt-4 pt-3 border-t border-slate-700/50 flex justify-between items-center text-xs text-slate-400">
                            <span>현재가/매수가</span>
                            <span class="text-slate-200 font-mono">₩ ${stock.price}</span>
                        </div>` : ''}
                    `;
                    gridHtml.appendChild(card);
                });

                sectorSection.innerHTML = headerHtml;
                sectorSection.appendChild(gridHtml);
                container.appendChild(sectorSection);
            });
            
            initIcons();
        }

        // Helper Functions
        function saveToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(recommendations));
        }

        function updateStats() {
            const uniqueStocks = new Set(recommendations.map(r => r.code || r.stockName)).size;
            document.getElementById('total-count').textContent = uniqueStocks;
            
            if(recommendations.length > 0) {
                const now = new Date();
                document.getElementById('last-update').textContent = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            } else {
                document.getElementById('last-update').textContent = '-';
            }
        }
    </script>
</body>
</html>
